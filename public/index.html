<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<title>Appsassin</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>

</head>
<body>
	<p>Enter your name:</p>
	<input type="text" name="answer" id="name" onkeyup="return checkEnter(event)"></input>
	<p>Enter game ID:</p>
	<input type="text" name="answer" id="gameid" onkeyup="return checkEnter(event)"></input>

	<p><button type="button" id="insert" onclick="insert()">Enter lobby</button></p>
	<p><button type="button" id="assign" onclick="assign()">Start game</button></p>
	<p><button type="button" id="clickToGet" onclick="getTarget()">Get Target</button></p>
	<p><button type="button" id="nextTarget" onclick="assignNext()">I've assassinated my target</button></p>


	
	<form method="post" enctype="multipart/form-data" action="https://peaceful-cove-69430.herokuapp.com/calibratePhoto">
		Username: <input type="text" name="userid">
	    <input type="file" name="photo">
	    <input type="submit" value="Submit">
	</form>

	<div id="lobby"></div>
	<h2 id="gameStatus"></h2>
	<h2 id="target"></h2>


	<script type="text/javascript">
	 	var request = new XMLHttpRequest();
	 	var server = "https://peaceful-cove-69430.herokuapp.com/";
	 	var messageData;
	 	var login;
	 	var gameID;

	 	// called by pressing "I've assassinated my target" button
	 	function assignNext() {
	 		login = $('#name').val();
	 		gameID = $('#gameid').val();

	 		request.open("POST", server + "/nextTarget", true);
	 		request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	 		request.openreadystatechange = function() {

	 		}
	 		request.send("login=" + login + "&gameID=" + gameID);
	 	}

	 	// called by pressing "Get Target" button
	 	function getTarget() {
	 		login = $('#name').val();
	 		gameID = $('#gameid').val();

	 		request.open("POST", server + "/getTarget", true);
	 		request.onreadystatechange = function() {
	 			if (request.readyState == 4 && request.status == 200) {
	 				messageData = request.responseText;
	 				$('#target').html("Your target: " + messageData);
	 			}
	 			else if (request.readyState == 4 && request.status != 200){
	 				alert('Request status not good');
	 			}
	 		}
	 		request.send("login=" + login + "&gameID=" + gameID);
	 	}

	 	// called by pressing "Start game" button
	 	function assign() {
	 		gameID = $('#gameid').val();

	 		request.open("POST", server + "/assignTargets", true);
	 		request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	 		request.onreadystatechange = function() {
	 			$("#gameStatus").html("Game started!");
	 		}
	 		request.send("gameID=" + gameID);

	 	}

	 	// called by pressing "Enter lobby" button
	 	function insert() { 		
	 		login = $('#name').val();
	 		gameID = $('#gameid').val();

	 		request.open("POST", server + "/joinGame", true);
	 		request.onreadystatechange = parse;
	 		request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	 		request.send("login=" + login + "&gameID=" + gameID);
	 	}

	 	// displays all players in same gameID 
	 	function showLobby() {
	 		var text = "<h1>Lobby</h1>";
	 		
	 		for (var i = 0; i < messageData.length; i++) {
	 			text += messageData[i] + "</br>";
	 		}

	 		$('#lobby').html(text);
 		
	 	}

	 	function parse()
	 	{
	 		if (request.readyState == 4 && request.status == 200) {
	 			// make server check if name is present
	 			messageData = JSON.parse(request.responseText);
	 			showLobby();	
	 		}
	 		else if (request.readyState == 4 && request.status != 200){
	 			alert('Request status not good');
	 		}
	 		
	 	}

	 	// checkEnter not implemented yet
		function checkEnter(e) 
		{
			if (e.keyCode == 13) {
				getInput();
				return false;
			}
		}

		// getInput not implemented yet
		function getInput()
		{
			input = $('#name').val();
			gameID = $('#gameid').val();
			

		}

	</script>

</body>
</html>